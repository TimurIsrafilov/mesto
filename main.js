(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{eS:()=>y,tI:()=>C});class t{constructor(e,t){this._formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inputErrorClass=e.inputErrorClass,this._inactiveButtonClass=e.inactiveButtonClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError=(e,t)=>{this._errorElement=this._formElement.querySelector(`.${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorElement.textContent=t};_hideInputError=e=>{this._errorElement=this._formElement.querySelector(`.${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorElement.textContent=""};_isValid(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}disableButton=()=>{this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._inactiveButtonClass)};_toggleButtonState(){this._hasInvalidInput()?this.disableButton():(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._isValid(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this.disableButton()})),this._setEventListeners()}}const s=".popup__form",r="popup_opened",n="elements__group_active",i=".popup_confirmation",o=".popup__submit-button",a={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inputErrorClass:"popup__input_state_invalid",inactiveButtonClass:"popup__submit-button_state_invalid"};class l{constructor(e,t,s,r,n){this._name=e.name,this._link=e.link,this._likes=e.likes,this._id=e.id,this._userId=e.userId,this._ownerId=e.ownerId,this._templateContent=s,this._handleCardClick=t,this._handleDeleteClick=r,this._handleLikeClick=n}isLiked(){return this._likes.some((e=>e._id===this._userId))}countLikesNumber(e){this._likes=e,this._cardElement.querySelector(".elements__likes-number").textContent=this._likes.length,this.isLiked()?this._addLike():this._removeLike()}createCard(){return this._cardElement=this._templateContent.cloneNode(!0),this._templatePhoto=this._cardElement.querySelector(".elements__mask-group"),this._templateTitle=this._cardElement.querySelector(".elements__title"),this._likeButton=this._cardElement.querySelector(".elements__group"),this._trashButton=this._cardElement.querySelector(".elements__trash-icon"),this._templatePhoto.src=this._link,this._templatePhoto.alt=this._name,this._templateTitle.textContent=this._name,this._ownerId!==this._userId&&(this._trashButton.style.display="none"),this._setEventListeners(),this.countLikesNumber(this._likes),this._cardElement}removeCard(){this._cardElement.remove(),this._cardElement=null}_addLike=()=>{this._likeButton.classList.add(n)};_removeLike=()=>{this._likeButton.classList.remove(n)};_handleCardOpen=()=>{this._handleCardClick(this._name,this._link)};_setEventListeners=()=>{this._likeButton.addEventListener("click",(()=>this._handleLikeClick(this._id))),this._trashButton.addEventListener("click",(()=>this._handleDeleteClick(this._id))),this._templatePhoto.addEventListener("click",this._handleCardOpen)}}class h{constructor(e){this._popupSelector=e,this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupSelector.classList.add(r),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupSelector.classList.remove(r),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupSelector.addEventListener("mousedown",(e=>{(e.target.classList.contains(r)||e.target.classList.contains("popup__close-icon"))&&this.close()}))}}class _ extends h{constructor(e,t){super(e),this._form=e.querySelector(s),this._handleFormSubmit=t,this._submitButton=this._form.querySelector(o),this._loadingText=this._submitButton.textContent}renderLoading(e){this._submitButton.textContent=e?"Сохранение...":this._loadingText}_getInputValues(){return this._inputList=this._form.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}close(){super.close(),this._form.reset()}}const d=document.querySelector(".popup_profile"),u=document.querySelector(".profile__edit-button"),c=d.querySelector(".popup__input_type_name"),p=d.querySelector(".popup__input_type_profession"),m=d.querySelector(s),f=document.querySelector(".elements"),v=document.querySelector(".card-template"),E=document.querySelector(".popup_card"),b=document.querySelector(".profile__add-button"),L=E.querySelector(s),k=v.content.querySelector(".elements__element"),S=document.querySelector(".popup_photo"),y=S.querySelector(".popup__mask-group"),C=S.querySelector(".popup__phototitle"),g=document.querySelector(i),q=(E.querySelector(s),g.querySelector(o),document.querySelector(".popup_avatar")),I=document.querySelector(".profile__avatar-button"),w=(q.querySelector(".popup__input_type_name"),q.querySelector(s));let B;const $=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_getResponseData(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getProfileInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._getResponseData)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._getResponseData)}editProfileInfo(e,t,s){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t,avatar:s})}).then(this._getResponseData)}addNewCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._getResponseData)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._getResponseData)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._getResponseData)}deleteLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._getResponseData)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._getResponseData)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-54",headers:{authorization:"0696f677-58b1-4ea2-bdfa-d2fcd17ccfa1","Content-Type":"application/json"}});function U(e){const t=new l(e,((e,t)=>{O.open(e,t)}),k,(e=>{j.open(),j.submitHandler((()=>{$.deleteCard(e).then((e=>{t.removeCard()})).catch((e=>console.log(`Ошибка.....: ${e}`)))}))}),(e=>{t.isLiked()?$.deleteLike(e).then((e=>{t.countLikesNumber(e.likes)})).catch((e=>console.log(`Ошибка.....: ${e}`))):$.addLike(e).then((e=>{t.countLikesNumber(e.likes)})).catch((e=>console.log(`Ошибка.....: ${e}`)))}));return t.createCard()}Promise.all([$.getProfileInfo(),$.getInitialCards()]).then((([e,t])=>{A.setUserInfo(e.name,e.about),A.setUserAvatar(e.avatar),B=e._id,t.forEach((e=>{const t=U({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:B,ownerId:e.owner._id});x.setItem(t)}))})).catch((e=>console.log(`Ошибка.....: ${e}`)));const x=new class{constructor({data:e,renderer:t},s){this._initialCards=e,this._renderer=t,this._container=s}renderItems(){this._initialCards.forEach((e=>{this._renderer(e)}))}setItem(e){this._container.prepend(e)}}({data:[],renderer:U},f),D=new _(E,(e=>{D.renderLoading(!0),$.addNewCard(e.place,e.reference).then((e=>{x.setItem(U({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:B,ownerId:e.owner._id}))})).catch((e=>console.log(`Ошибка.....: ${e}`))).finally((()=>{D.renderLoading(!1)}))}),f),P=new _(q,(e=>{P.renderLoading(!0),$.updateAvatar(e.avatar).then((t=>{A.setUserAvatar(e.avatar)})).catch((e=>console.log(`Ошибка.....: ${e}`))).finally((()=>{P.renderLoading(!1)}))})),A=new class{constructor({name:e,profession:t,avatar:s}){this._name=document.querySelector(e),this._profession=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,profession:this._profession.textContent}}setUserInfo(e,t){this._name.textContent=e,this._profession.textContent=t}setUserAvatar(e){this._avatar.src=e}}({name:".profile__title",profession:".profile__subtitle",avatar:".profile__avatar"}),T=new t(a,m),V=new t(a,L),N=new t(a,w),O=new class extends h{constructor(e){super(e)}open(e,t){y.src=t,y.alt=e,C.textContent=e,super.open()}}(S),R=new _(d,(e=>{R.renderLoading(!0),$.editProfileInfo(e.name,e.profession).then((t=>{A.setUserInfo(e.name,e.profession)})).catch((e=>console.log(`Ошибка.....: ${e}`))).finally((()=>{R.renderLoading(!1)}))})),j=new class extends h{constructor(e){super(e),this._popup=document.querySelector(i),this._form=this._popup.querySelector(s)}submitHandler(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(),this.close()}))}}(g);x.renderItems(),T.enableValidation(),V.enableValidation(),N.enableValidation(),O.setEventListeners(),R.setEventListeners(),D.setEventListeners(),j.setEventListeners(),P.setEventListeners(),u.addEventListener("click",(()=>{const{name:e,profession:t}=A.getUserInfo();c.value=e,p.value=t,R.open()})),b.addEventListener("click",(()=>D.open())),I.addEventListener("click",(()=>P.open()))})();