(()=>{"use strict";var e={d:(t,s)=>{for(var r in s)e.o(s,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:s[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{eS:()=>I,tI:()=>w});class t{constructor(e,t){this._formElement=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inputErrorClass=e.inputErrorClass,this._inactiveButtonClass=e.inactiveButtonClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError=(e,t)=>{this._errorElement=this._formElement.querySelector(`.${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorElement.textContent=t};_hideInputError=e=>{this._errorElement=this._formElement.querySelector(`.${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorElement.textContent=""};_isValid(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}disableButton=()=>{this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._inactiveButtonClass)};_toggleButtonState(){this._hasInvalidInput()?this.disableButton():(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._isValid(e),this._toggleButtonState()}))}))}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this.disableButton()})),this._setEventListeners()}}const s=".popup_profile",r=".popup__form",n=".popup_photo",i=".popup_card",o="popup_opened",a="elements__group_active",l=".popup_confirmation",h=".popup__submit-button",_=".popup_avatar",u={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inputErrorClass:"popup__input_state_invalid",inactiveButtonClass:"popup__submit-button_state_invalid"};class d{constructor(e,t,s,r,n){this._name=e.name,this._link=e.link,this._likes=e.likes,this._id=e.id,this._userId=e.userId,this._ownerId=e.ownerId,this._templateContent=s,this._handleCardClick=t,this._handleDeleteClick=r,this._handleLikeClick=n}isLiked(){return this._likes.some((e=>e._id===this._userId))}countLikesNumber(e){this._likes=e,this._cardElement.querySelector(".elements__likes-number").textContent=this._likes.length,this.isLiked()?this._addLike():this._removeLike()}createCard(){return this._cardElement=this._templateContent.cloneNode(!0),this._templatePhoto=this._cardElement.querySelector(".elements__mask-group"),this._templateTitle=this._cardElement.querySelector(".elements__title"),this._likeButton=this._cardElement.querySelector(".elements__group"),this._trashButton=this._cardElement.querySelector(".elements__trash-icon"),this._templatePhoto.src=this._link,this._templatePhoto.alt=this._name,this._templateTitle.textContent=this._name,this._ownerId!==this._userId&&(this._trashButton.style.display="none"),this._setEventListeners(),this.countLikesNumber(this._likes),this._cardElement}removeCard(){this._cardElement.remove(),this._cardElement=null}_addLike=()=>{this._likeButton.classList.add(a)};_removeLike=()=>{this._likeButton.classList.remove(a)};_handleCardOpen=()=>{this._handleCardClick(this._name,this._link)};_setEventListeners=()=>{this._likeButton.addEventListener("click",(()=>this._handleLikeClick(this._id))),this._trashButton.addEventListener("click",(()=>this._handleDeleteClick(this._id))),this._templatePhoto.addEventListener("click",this._handleCardOpen)}}class c{constructor(e){this._popupSelector=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupSelector.classList.add(o),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupSelector.classList.remove(o),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupSelector.addEventListener("mousedown",(e=>{(e.target.classList.contains(o)||e.target.classList.contains("popup__close-icon"))&&this.close()}))}}class p extends c{constructor(e,t){super(e),this._form=this._popupSelector.querySelector(r),this._handleFormSubmit=t,this._submitButton=this._form.querySelector(h),this._loadingText=this._submitButton.textContent}renderLoading(e){this._submitButton.textContent=e?"Сохранение...":this._loadingText}_getInputValues(){return this._inputList=this._form.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}close(){super.close(),this._form.reset()}}const m=document.querySelector(s),v=document.querySelector(".profile__edit-button"),f=m.querySelector(".popup__input_type_name"),E=m.querySelector(".popup__input_type_profession"),b=m.querySelector(r),L=document.querySelector(".elements"),S=document.querySelector(".card-template"),y=document.querySelector(i),k=document.querySelector(".profile__add-button"),C=y.querySelector(r),g=S.content.querySelector(".elements__element"),q=document.querySelector(n),I=q.querySelector(".popup__mask-group"),w=q.querySelector(".popup__phototitle"),B=document.querySelector(l),U=(y.querySelector(r),B.querySelector(h),document.querySelector(_)),$=document.querySelector(".profile__avatar-button"),x=(U.querySelector(".popup__input_type_name"),U.querySelector(r));let D;const P=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_getResponseData(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getProfileInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._getResponseData)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._getResponseData)}editProfileInfo(e,t,s){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t,avatar:s})}).then(this._getResponseData)}addNewCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(this._getResponseData)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._getResponseData)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._getResponseData)}deleteLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._getResponseData)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._getResponseData)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-54",headers:{authorization:"0696f677-58b1-4ea2-bdfa-d2fcd17ccfa1","Content-Type":"application/json"}});function A(e){const t=new d(e,((e,t)=>{J.open(e,t)}),g,(e=>{z.open(),z.submitHandler((()=>{P.deleteCard(e).then((e=>{t.removeCard()})).catch((e=>console.log(`Ошибка.....: ${e}`)))}))}),(e=>{(t.isLiked()?P.deleteLike(e):P.addLike(e)).then((e=>{t.countLikesNumber(e.likes)})).catch((e=>console.log(`Ошибка.....: ${e}`)))}));return t.createCard()}Promise.all([P.getProfileInfo(),P.getInitialCards()]).then((([e,t])=>{O.setUserInfo(e.name,e.about),O.setUserAvatar(e.avatar),D=e._id,T.renderItems(t)})).catch((e=>console.log(`Ошибка.....: ${e}`)));const T=new class{constructor({renderer:e},t){this._renderer=e,this._container=t}renderItems(e){e.forEach((e=>{this._container.append(this._renderer(e))}))}setItem(e){this._container.prepend(e)}}({renderer:e=>A({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:D,ownerId:e.owner._id})},L),V=new p(i,(e=>{V.renderLoading(!0),P.addNewCard(e.place,e.reference).then((e=>{T.setItem(A({name:e.name,link:e.link,likes:e.likes,id:e._id,userId:D,ownerId:e.owner._id}))})).catch((e=>console.log(`Ошибка.....: ${e}`))).finally((()=>{V.renderLoading(!1)}))}),L),N=new p(_,(e=>{N.renderLoading(!0),P.updateAvatar(e.avatar).then((t=>{O.setUserAvatar(e.avatar)})).catch((e=>console.log(`Ошибка.....: ${e}`))).finally((()=>{N.renderLoading(!1)}))})),O=new class{constructor({name:e,profession:t,avatar:s}){this._name=document.querySelector(e),this._profession=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,profession:this._profession.textContent}}setUserInfo(e,t){this._name.textContent=e,this._profession.textContent=t}setUserAvatar(e){this._avatar.src=e}}({name:".profile__title",profession:".profile__subtitle",avatar:".profile__avatar"}),R=new t(u,b),j=new t(u,C),H=new t(u,x),J=new class extends c{constructor(e){super(e)}open(e,t){I.src=t,I.alt=e,w.textContent=e,super.open()}}(n),F=new p(s,(e=>{F.renderLoading(!0),P.editProfileInfo(e.name,e.profession).then((t=>{O.setUserInfo(e.name,e.profession)})).catch((e=>console.log(`Ошибка.....: ${e}`))).finally((()=>{F.renderLoading(!1)}))})),z=new class extends c{constructor(e){super(e),this._popup=document.querySelector(l),this._form=this._popup.querySelector(r)}submitHandler(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit(),this.close()}))}}(l);R.enableValidation(),j.enableValidation(),H.enableValidation(),J.setEventListeners(),F.setEventListeners(),V.setEventListeners(),z.setEventListeners(),N.setEventListeners(),v.addEventListener("click",(()=>{const{name:e,profession:t}=O.getUserInfo();f.value=e,E.value=t,F.open()})),k.addEventListener("click",(()=>V.open())),$.addEventListener("click",(()=>N.open()))})();